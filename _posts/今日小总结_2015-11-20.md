=======================================================
今日总结一下，关于公司服务端出的问题，导致的数据丢失的总结报告 
####
#### 20151114备份钥匙误删事故
#### 总结报告

###### 一、问题发现
11-14周六下午，驻客公寓用户反映“我的备份”中所有备份钥匙丢失，提示“暂无备份钥匙”。
查看后发现我们自己的账号也有此现象，iOS和Android都是。
查看数据库，发现近2个月的备份钥匙数据消失。

###### 二、原因分析
服务端接口分为新老2个版本，老版本的数据格式为xml，新版本是json。
新版本在数据库中增加了一个keyid字段。为兼容老版本，原先保存keyid的字段仍然保留，值默认设为0。
当有APP调用老版本的删除备份钥匙接口，并且keyid参数传值为0时，通过新版本接口保存的备份钥匙都被删除。
由于进行的是硬删除，并且数据库没有备份，无法进行数据恢复，只能由用户重新进行备份操作。

###### 三、处理应对
1）修改老版本删除备份钥匙接口，改进keyid校验。
2）排查APP是否存在调用老版本接口的情况。发现iOS版本，当用户将分组名称设为“备份钥匙”时存在这个情况，已进行修正。
3）发布通知，让公司全体了解这个情况。

###### 四、存在问题
1）代码逻辑，老版本keyid合法性校验
2）数据库设计，采用新字段的必要性？原字段默认值处理是否合理？
3）采用硬删除方式，是应用开发的大忌
4）没有数据库备份机制，导致数据无法恢复

###### 五、改进方法
1）代码复查，排除其他类似隐患
2）系统改进，消除硬删除
3）建立数据库备份机制，编写脚本进行每日备份
4）迁移到阿里云数据库，保障数据安全


